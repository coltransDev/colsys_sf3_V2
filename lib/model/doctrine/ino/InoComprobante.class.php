<?php

/**
 * InoComprobante
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 6508 2009-10-14 06:28:49Z jwage $
 */
class InoComprobante extends BaseInoComprobante
{

    const ABIERTO = 0;
    const PARA_TRANSFERIR = 1;
    const TRANSFERIDO = 1;

    public function getValor(){
        $tipo = $this->getInoTipoComprobante();

        $q = Doctrine::getTable("InoTransaccion")
                  ->createQuery("t");
        $q->select("SUM(t.ca_valor) as valor,t.ca_db");
        $q->addWhere("t.ca_idcomprobante = ?", $this->getCaIdcomprobante());
        $q->addWhere("t.ca_idcuenta = ?", $tipo->getCaIdctaCierre());
        $q->addGroupBy("t.ca_db");
        $vals = $q->setHydrationMode(Doctrine::HYDRATE_SCALAR)->execute();
        


        $total = 0;
        foreach( $vals as $val ){
            if( $val["t_ca_db"] ){
                $total+=$val["t_valor"];
            }else{
                $total-=$val["t_valor"];
            }
        }
        
        return $total;
    }
    
}