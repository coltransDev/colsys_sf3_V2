<?php

/**
 * Formulario
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    colmob
 * @subpackage model
 * @author     Gabriel Martinez Rojas
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Formulario extends BaseFormulario {

    public function __toString() {
        return $this->getCaId() . '. ' . $this->getCaTitulo();
    }

    public function getActivoValue($id) {
        if ($id == 1) {
            echo 'Si';
        } else {
            echo 'No';
        }
    }

    /**
     *
     * @return <type> 
     */
    public function getQueryFormulario() {
        $q = Doctrine_Query::create()
                        ->from('formulario')
                        ->orderBy('ca_id DESC');
        return $q;
    }

    public function getTieneServicio($id_formulario) {
        $q = Doctrine_Query::create()
                        ->from('bloque')
                        ->where('ca_idformulario = ?', $id_formulario)
                        ->andWhere('ca_activo = ?', 1)
                        ->andWhere('ca_tipo = ?', 0)
                        ->orderBy('ca_orden ASC');
        return $q->fetchOne();
    }

    public function getBloqueServicio($id_formulario) {
        $q = Doctrine_Query::create()
                        ->from('bloque')
                        ->where('ca_idformulario = ?', $id_formulario)
                        ->andWhere('ca_activo = ?', 1)
                        ->andWhere('ca_tipo = ?', 1)
                        ->orderBy('ca_orden ASC');
        return $q->fetchOne();
    }

    public function getBloques($id_formulario) {
        $q = Doctrine_Query::create()
                        ->from('bloque')
                        ->where('ca_idformulario = ?', $id_formulario)
                        ->andWhere('ca_activo = ?', 1)
                        ->andWhere('ca_tipo = ?', 0)
                        ->orderBy('ca_orden ASC');
        return $q->execute();
    }

    public function getBloquesOrdenados($id_formulario) {
        $q = Doctrine_Query::create()
                        ->from('bloque')
                        ->where('ca_idformulario = ?', $id_formulario)
                        ->andWhere('ca_activo = ?', 1)
                        ->andWhere('ca_tipo = ?', 0)
                        ->orderBy('ca_tipo DESC', 'ca_orden ASC');
        return $q->execute();
    }

    public function getTodosBloquesOrdenados($id_formulario) {
        $q = Doctrine_Query::create()
                        ->from('bloque')
                        ->where('ca_idformulario = ?', $id_formulario)
                        ->andWhere('ca_activo = ?', 1)
                        ->orderBy('ca_tipo DESC', 'ca_orden ASC');
        return $q->execute();
    }

    public static function getContarFormularios() {
        $q = Doctrine_Query::create()
                        ->from('Formulario j');
        return Doctrine_Core::getTable('Formulario')->contarFormularios($q);
    }

    public static function contarEncuestas(Doctrine_Query $q = null) {
        $q = Doctrine_Query::create()
                        ->from('controlEncuesta')
                        ->where('ca_idformulario = ?', 1)
                        ->andWhere('ca_tipo_contestador = ?', 1);
        return $q->count();
    }

    public static function getResultados($id_control) {
        $q = Doctrine_Query::create()
                        ->from('resultadoEncuesta')
                        ->andWhere('ca_idcontrolencuesta= ?', $id_control)                  
                        ->orderBy('ca_servicio ASC');
        return $q->execute();
    }

    public static function getServicio($servicio) {
        $cadena = trim($servicio);
        switch ($cadena) {
            case 1:
                return "Importaciones aéreo";
                break;
            case 2:
                return "Importaciones marítimo";
                break;
            case 3:
                return "Exportaciones aéreo";
                break;
            case 4:
                return "Exportaciones marítimo";
                break;
            default:
                return "no definido / todos los servicio";
        }
    }

    public function getPregunta($idPregunta) {
        $q = Doctrine_Query::create()
                        ->from('pregunta')
                        ->where('ca_id = ?', $idPregunta);
        return $q->fetchOne();
    }

}

