<?php

/**
 * NotListaTareas
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 5845 2009-06-09 07:36:57Z jwage $
 */
class NotListaTareas extends BaseNotListaTareas
{
    /*
	* Lista de tareas pendientes
	*/
	public function getTareasPendientes( $user=null ){
		
        $q = Doctrine::getTable("NotTarea")
                                     ->createQuery("t")
                                     ->innerJoin("t.NotTareaAsignacion a")
                                     ->select("t.*")
                                     ->where("t.ca_fchterminada Is NULL")
                                     ->addWhere("t.ca_fchvisible <= ?",date("Y-m-d H:i:s") )                                     
                                     ->addWhere("t.ca_idlistatarea = ? ", $this->getCaIdlistatarea() )
                                     ->addOrderBy("t.ca_prioridad")
                                     ->addOrderBy("t.ca_fchvencimiento")
                                     ->distinct();
        if( $user ){
            $q->addWhere("a.ca_login = ?", $user );
        }
        return $q->execute();


	}
}